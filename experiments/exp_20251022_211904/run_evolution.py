#!/usr/bin/env python3
'''
Auto-generated evolution runner script.
Generated by AgentEvolve.

Objective: Maximize bypass rate on Claude Sonnet 4
Evolution Type: prompt
'''

import sys
import os

# Add Shinka to path
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..', '..', 'ShinkaEvolve'))

from shinka.core import EvolutionRunner, EvolutionConfig
from shinka.database import DatabaseConfig
from shinka.launch import LocalJobConfig


def main():
    '''Run the evolution experiment.'''

    # Job configuration
    job_config = LocalJobConfig(
        eval_program_path="evaluate.py"
    )

    # Database configuration
    db_config = DatabaseConfig(
        num_islands=3,
        archive_size=30,
        elite_selection_ratio=0.3,
        num_archive_inspirations=3,
        num_top_k_inspirations=2,
    )

    # Evolution configuration
    evo_config = EvolutionConfig(
        task_sys_msg='''{config.shinka_config['evo_config']['task_sys_msg']}''',
        num_generations=30,
        max_parallel_jobs=1,
        llm_models=['gpt-4.1-mini', 'gemini-2.0-flash-001'],
        patch_types=['diff', 'full'],
        patch_type_probs=[0.7, 0.3],
        language="python",
        init_program_path="initial.py",
    )

    # Run evolution
    print("ðŸ§¬ Starting evolution experiment...")
    print(f"Objective: Maximize bypass rate on Claude Sonnet 4")
    print(f"Generations: {evo_config.num_generations}")
    print()

    runner = EvolutionRunner(
        evo_config=evo_config,
        job_config=job_config,
        db_config=db_config,
        verbose=True,
    )

    runner.run()

    print()
    print("âœ“ Evolution complete!")
    print(f"Results saved to: {os.path.dirname(__file__)}/results_*/")


if __name__ == "__main__":
    main()
